---
name: spec-writer
description: Write technical specification documents for the Professional Evaluation project. Use when creating design specs, API specs, data model specs, or any technical documentation. MUST create a folder under the appropriate category directory (01-06) in spec/ and save plan spec as plan.md in that folder.
allowed-tools: Read, Grep, Glob, Edit(spec/**), Write(spec/**), Bash(mkdir:*)
model: claude-sonnet-4-5
---

# Spec Writer

## 概述

这个 Skill 专门用于为 AI+专业评估系统项目撰写技术规格文档（Spec）。所有 Spec 文档必须保存到 `spec/` 目录下对应分类目录的子文件夹中，并遵循统一的命名和格式规范。

## 核心规则

### 0. MCP 确认工具（必须使用）

> [!important] 必须使用 MCP 工具等待用户确认
> 完成 plan.md 撰写后，**必须**调用 `spec_confirm` MCP 工具等待用户确认，不要直接询问用户。

```python
# 保存 plan.md 后立即调用
mcp__obsidian-spec-confirm__spec_confirm(
    file_path="spec/分类目录/YYYYMMDD-HHMM-任务描述/plan.md",
    doc_type="plan",
    title="文档标题"
)
```

### 1. 目录分类结构

**必须遵守**：Spec 必须放入对应的分类目录（01-06）

**分类目录说明**：

| 目录 | 名称 | 用途 | 适用场景 |
|------|------|------|----------|
| `01-项目规划` | 项目规划 | 项目整体规划、PRD、流程设计 | 新项目启动、功能规划、流程设计 |
| `02-架构设计` | 架构设计 | 系统架构、数据模型、服务层设计 | 架构设计、数据结构、服务接口 |
| `03-功能实现` | 功能实现 | 具体功能的实现方案 | 新功能开发、功能增强、集成方案 |
| `04-问题修复` | 问题修复 | Bug 修复、问题解决方案 | Bug 修复、错误处理、问题排查 |
| `05-测试文档` | 测试文档 | 测试计划、测试报告、测试总结 | 测试准备、测试执行、测试总结 |
| `06-已归档` | 已归档 | 已完成并归档的 Spec | 执行完成后由 spec-executor 移动 |

**目录结构**：
```
spec/
├── 01-项目规划/
│   ├── PRD-AI专业评估系统.md
│   └── 【流程】AI+专业评估.md
├── 02-架构设计/
│   ├── 20260104-1030-服务层架构设计/
│   │   ├── plan.md
│   │   └── summary.md
│   └── 20260104-1430-数据模型设计/
│       ├── plan.md
│       └── summary.md
├── 03-功能实现/
│   ├── 20260104-0900-专业评价Agent设计/
│   │   ├── plan.md
│   │   └── summary.md
│   └── 20260104-1600-评估接口规范/
│       ├── plan.md
│       └── summary.md
├── 04-问题修复/
│   ├── 20260104-1713-WebSocket连接修复/
│   │   ├── plan.md
│   │   └── summary.md
│   └── 20260104-1045-评分精度问题修复/
│       └── plan.md
├── 05-测试文档/
│   └── 20260104-1500-集成测试计划/
│       └── plan.md
└── 06-已归档/
    └── （已完成的 Spec 会被移动到这里）
```

### 2. 分类选择规则

**根据 Spec 类型选择目录**：

| Spec 类型 | 目标目录 | 示例 |
|-----------|----------|------|
| 项目规划、PRD、流程设计 | `01-项目规划` | PRD文档、业务流程 |
| 架构设计、数据模型、服务层设计 | `02-架构设计` | Framework设计、数据结构 |
| 功能实现、API规范、集成方案 | `03-功能实现` | Agent实现、API接口 |
| Bug修复、问题解决、错误处理 | `04-问题修复` | WebSocket修复、评分Bug |
| 测试计划、测试报告、测试总结 | `05-测试文档` | 集成测试、性能测试 |
| 已完成归档 | `06-已归档` | 由 spec-executor 移动 |

✅ **允许的路径**：
- `spec/02-架构设计/20260104-1030-服务层架构设计/plan.md`
- `spec/03-功能实现/20260104-0900-专业评价Agent设计/plan.md`
- `spec/04-问题修复/20260104-1713-WebSocket连接修复/plan.md`

❌ **禁止的路径**：
- `spec/20260104-1030-design/plan.md` （未放入分类目录）
- `spec/20260104-design.md` （直接在 spec/ 下）
- `spec/03-功能实现/20260104-feature-design/plan.md` （任务描述必须用中文）
- `docs/spec/plan.md` （错误目录）

### 3. 文件夹命名规范

**格式**：`YYYYMMDD-HHMM-任务描述`

**命名规则**：
- 日期格式：8位数字，如 `20260104`
- 时间格式：4位数字（小时分钟），如 `1713`
- 分隔符：使用连字符 `-`
- **任务描述：必须使用中文**，简洁明确，说明这个 Spec 的作用

**示例**：
```
20260104-1713-专业评价Agent设计
20260104-0930-数据模型重构方案
20260104-1445-WebSocket连接修复
20260104-1600-评估任务服务层设计
20260104-1030-材料解析功能实现
```

**禁止的命名**：
```
❌ 20260104-framework-service-design    # 任务描述必须用中文
❌ 20260104-api-specification           # 任务描述必须用中文
❌ 20251231-专业评价Agent设计            # 缺少时间部分
❌ 专业评价Agent设计                     # 缺少日期和时间
```

### 4. 文件命名规范

**固定文件名**：
- `plan.md` - 计划 Spec（由 spec-writer 创建）
- `summary.md` - 总结 Spec（由 spec-executor 创建）

**说明**：
- `plan.md`：包含设计方案、实现步骤、测试计划等
- `summary.md`：包含实现总结、测试结果、遇到的问题、解决方案等

### 5. 文档类型与分类对应

根据不同的开发需求，创建相应类型的 Spec 并放入对应目录：

| 文档类型 | 目标目录 | 文件夹命名示例 |
|---------|----------|--------------|
| 项目规划 | `01-项目规划` | `20260104-1030-项目整体规划/` |
| 架构设计 | `02-架构设计` | `20260104-1430-系统架构设计/` |
| 数据模型 | `02-架构设计` | `20260104-0900-数据模型设计/` |
| 服务层设计 | `02-架构设计` | `20260104-1600-服务层接口设计/` |
| 功能设计 | `03-功能实现` | `20260104-1045-功能模块设计/` |
| API 规范 | `03-功能实现` | `20260104-1130-接口规范定义/` |
| 集成方案 | `03-功能实现` | `20260104-1500-系统集成方案/` |
| 修复方案 | `04-问题修复` | `20260104-1713-问题修复方案/` |
| 重构方案 | `04-问题修复` | `20260104-0930-代码重构方案/` |
| 测试计划 | `05-测试文档` | `20260104-1400-测试计划/` |
| 测试报告 | `05-测试文档` | `20260104-1700-测试报告/` |

## 工作流程

使用此检查清单跟踪进度：

```
Spec 文档撰写流程：
- [ ] 步骤 1：理解需求和背景
- [ ] 步骤 2：确定文档类型和目标分类目录
- [ ] 步骤 3：确定文件夹命名
- [ ] 步骤 4：创建 Spec 文件夹（在分类目录下）
- [ ] 步骤 5：选择合适的模板
- [ ] 步骤 6：撰写 plan.md 内容
- [ ] 步骤 7：验证文件路径和命名
- [ ] 步骤 8：保存到 spec/分类目录/任务文件夹/plan.md
- [ ] 步骤 9：等待用户确认
```

### 步骤详解

#### 步骤 1：理解需求和背景

在开始撰写前，必须：
1. 阅读用户的需求描述
2. 查看相关的现有代码和文档
3. 理解项目的整体架构（参考 `CLAUDE.md`）
4. 确认是否需要查看现有的 Spec 文档

#### 步骤 2：确定文档类型和目标分类目录

根据需求确定文档类型，然后选择对应的分类目录：

| 需求类型 | 文档类型 | 目标目录 |
|----------|----------|----------|
| 项目规划、PRD | 项目规划 | `01-项目规划` |
| 架构、数据模型、服务层 | 架构设计 | `02-架构设计` |
| 新功能、API、集成 | 功能实现 | `03-功能实现` |
| Bug修复、问题解决 | 问题修复 | `04-问题修复` |
| 测试计划、测试报告 | 测试文档 | `05-测试文档` |

#### 步骤 3：确定文件夹命名

生成文件夹名：`YYYYMMDD-HHMM-任务描述`（任务描述必须用中文）

**示例**：
```
需求：设计专业评价 Agent 的数据流程
文档类型：架构设计
目标目录：02-架构设计
当前时间：2026-01-04 17:13
任务描述：专业评价Agent数据流程
文件夹名：20260104-1713-专业评价Agent数据流程
完整路径：spec/02-架构设计/20260104-1713-专业评价Agent数据流程/plan.md
```

#### 步骤 4：创建 Spec 文件夹（在分类目录下）

使用 `Bash` 工具创建文件夹：
```bash
mkdir -p "spec/02-架构设计/20260104-1713-任务描述"
```

**验证**：
- 文件夹在正确的分类目录下
- 文件夹名格式正确：`YYYYMMDD-HHMM-中文任务描述`
- 日期和时间是当前的日期和时间

#### 步骤 5：选择合适的模板

根据文档类型选择模板（详见 [TEMPLATES.md](TEMPLATES.md)）：
- 功能设计模板
- API 规范模板
- 数据模型模板
- 架构设计模板
- 重构方案模板

#### 步骤 5：撰写 plan.md 内容

遵循以下原则：
1. **明确性**：需求和设计必须清晰明确
2. **完整性**：包含所有必要的技术细节
3. **可追溯性**：设计决策要有依据
4. **可实施性**：提供具体的实现步骤
5. **中文优先**：使用中文作为主要语言
6. **Obsidian 格式优化**：撰写时直接应用 Obsidian 特性增强文档

**plan.md 必须包含**：
- **Frontmatter 元数据**（必须放在文件最开头）
- 概述（背景、目标、范围）
- 需求分析
- 设计方案
- 实现步骤
- 测试计划
- 风险和依赖
- **文档关联**（固定章节，用于后续文档链接）

**Frontmatter 格式（必须）**：

```yaml
---
title: 功能名称
type: plan
category: 03-功能实现
status: 未确认
priority: 高
created: YYYY-MM-DD
tags:
  - spec
  - plan
related: []
---
```

**Frontmatter 字段说明**：

| 字段 | 必填 | 说明 | 可选值 |
|------|------|------|--------|
| `title` | 是 | Spec 标题 | - |
| `type` | 是 | 文档类型 | `plan` |
| `category` | 是 | 分类目录 | `01-项目规划`/`02-架构设计`/`03-功能实现`/`04-问题修复`/`05-测试文档` |
| `status` | 是 | 当前状态 | `未确认`/`已确认`/`已归档` |
| `priority` | 是 | 优先级 | `高`/`中`/`低` |
| `created` | 是 | 创建日期 | `YYYY-MM-DD` 格式 |
| `tags` | 是 | 标签列表 | 至少包含 `spec` 和 `plan` |
| `related` | 否 | 关联的其他 Spec | 双链列表 |

**status 状态变更规则**：

```
┌─────────────┐    用户确认执行    ┌─────────────┐    归档完成    ┌─────────────┐
│   未确认    │ ─────────────────→ │   已确认    │ ────────────→ │   已归档    │
└─────────────┘                    └─────────────┘               └─────────────┘
       ↑                                  │
       │         用户修改文档内容          │
       └──────────────────────────────────┘
```

| 触发条件 | 状态变更 | 操作说明 |
|----------|----------|----------|
| 创建 plan.md | → `未确认` | 初始状态 |
| 用户确认执行 | `未确认` → `已确认` | 用户明确表示可以开始实现时，更新 frontmatter |
| 用户修改文档 | `已确认` → `未确认` | 文档内容被修改后，需重新确认 |
| 归档完成 | `已确认` → `已归档` | 由 spec-executor 在归档时更新 |

**文档关联章节格式**：

plan.md 作为起点文档，其文档关联章节用于预留后续文档的链接位置：

```markdown
## 文档关联

- 实现总结: [[summary|实现总结]] (待创建)
- 审查报告: [[review|审查报告]] (待创建)
```

> **注意**：plan.md 创建时，这些链接目标尚不存在，会显示为「未创建文件」，这是正常的。执行实现后会自动生效。

**Obsidian 格式优化（撰写时应用）**：

1. **文档关联（必须）**：使用双链建立文档间的关系
   - **plan.md**：预留 summary 和 review 的链接
   - **关联其他 Spec**：使用完整路径链接相关文档
   - 示例：`参见 [[../20260103-1430-数据模型设计/plan|数据模型设计]]`

2. **使用 Callout 突出重要信息**：
   - `> [!warning]` 标注风险和注意事项
   - `> [!tip]` 标注最佳实践建议
   - `> [!important]` 标注关键决策
   - `> [!note]` 添加补充说明

3. **添加标签**：在 frontmatter 或正文中添加标签便于检索
   - 示例：`#spec/功能实现` `#agent` `#评估系统`

**相关 Skill**：
- 详细 Obsidian Markdown 语法：使用 `obsidian-markdown` Skill
- 创建 Spec 关系图：使用 `json-canvas` Skill 可视化 Spec 之间的依赖关系
- 创建 Spec 索引视图：使用 `obsidian-bases` Skill 创建动态 Spec 列表

### 文档链接规则速查

| 当前文档 | 必须链接到 | 链接格式 |
|---------|-----------|----------|
| `plan.md` | 无（起点文档） | - |
| `plan.md`（可选） | 相关的其他 Spec | `[[../文件夹名/plan\|显示文本]]` |
| `plan.md`（预留） | summary/review | `[[summary\|实现总结]] (待创建)` |

#### 步骤 7：验证文件路径和命名

在保存前，验证：
- [ ] 文件夹路径是 `spec/分类目录/YYYYMMDD-HHMM-任务描述/`
- [ ] 分类目录正确（01-05 之一）
- [ ] 文件名是 `plan.md`
- [ ] 日期和时间是当前的日期和时间
- [ ] 任务描述使用中文，简洁明确

#### 步骤 8：保存到 spec/分类目录/任务文件夹/plan.md

使用 `Write` 工具保存文件：
```
Write(file_path="spec/02-架构设计/20260104-1713-任务描述/plan.md", content="...")
```

#### 步骤 9：等待用户确认（使用 MCP 工具）

保存后，使用 `spec_confirm` MCP 工具等待用户确认：

```python
# 使用 MCP 工具等待用户确认
mcp__obsidian-spec-confirm__spec_confirm(
    file_path="spec/分类目录/YYYYMMDD-HHMM-任务描述/plan.md",
    doc_type="plan",
    title="文档标题"
)
```

**确认流程**：
1. 工具调用后，侧边栏会自动打开，显示文档信息和确认按钮
2. 用户在 Obsidian 中审阅文档
3. 审阅完成后，用户在侧边栏点击"✓ 确认"或"✗ 需要修改"
4. 收到确认响应后，根据用户反馈继续或修改

**响应处理**：
- `action: "continue"` - 用户确认，可以开始实现
- `action: "modify"` - 用户需要修改，根据 `userMessage` 调整 Spec
- `newStatus: "已确认"` - 文档状态已更新为已确认

## 重要提醒

### ⚠️ 开发顺序约束

根据 `CLAUDE.md` 的要求：

1. **先创建 Spec，用户确认后再开发**
2. **开发顺序**：Framework 服务层 → Agent 层 → API 层
3. **严格遵循 Spec**：不允许做任何与 Spec 无关的开发
4. **修改需要新 Spec**：任何修改和修复都需要先创建 Spec 等待用户确认

### ⚠️ 禁止的操作

- ❌ 不要在 Spec 确认前开始编写代码
- ❌ 不要直接在 spec/ 目录下创建文件夹（必须放入分类目录）
- ❌ 不要直接在分类目录下创建 .md 文件（必须创建任务文件夹）
- ❌ 不要使用错误的文件夹命名格式
- ❌ 不要将 plan.md 命名为其他名称
- ❌ 不要添加 Spec 中未定义的功能
- ❌ 不要跳过用户确认步骤
- ❌ 不要手动将 Spec 移动到 `06-已归档`（由 spec-executor 完成）

### ✅ 推荐的操作

- ✅ 先理解需求，再撰写 Spec
- ✅ 根据 Spec 类型选择正确的分类目录（01-05）
- ✅ 在分类目录下创建独立的任务文件夹
- ✅ 使用标准模板确保一致性
- ✅ 包含足够的技术细节
- ✅ 提供清晰的实现步骤
- ✅ 说明 summary.md 将在执行后创建
- ✅ 说明执行完成后会归档到 `06-已归档`
- ✅ 等待用户确认后再开发

## 项目特定要求

### 数据结构设计

在设计数据结构时，必须明确：
- 哪些内容是系统预设的
- 哪些内容是 Agent 填写的
- 数据的流转路径和生命周期

### Agent 设计

设计 Agent 时，必须考虑：
- 输入数据格式和来源
- 输出数据格式和用途
- 评分过程的可追溯性
- 并发场景的支持

### 可追溯性优先

专业评价 Agent 的评分过程必须：
- 保证可追溯性
- 避免黑盒式评价
- 明确评分依据
- 引用具体材料和标准

## 快速参考

### 常用命令

查看分类目录结构：
```bash
ls spec/
```

查看特定分类目录的内容：
```bash
ls "spec/02-架构设计/"
ls "spec/03-功能实现/"
ls "spec/04-问题修复/"
```

查看特定 Spec 的内容：
```bash
ls "spec/02-架构设计/20251231-任务描述/"
```

搜索相关 Spec：
```bash
grep -r "关键词" spec/
```

### 文件结构速查

```bash
# 当前日期时间（示例）
20260104-1713

# 完整路径示例（按分类目录，任务描述必须用中文）
spec/01-项目规划/20260104-1030-项目整体规划/plan.md
spec/02-架构设计/20260104-1430-服务层架构设计/plan.md
spec/03-功能实现/20260104-0900-专业评价Agent设计/plan.md
spec/04-问题修复/20260104-1713-WebSocket连接修复/plan.md
spec/05-测试文档/20260104-1500-集成测试计划/plan.md

# 执行后会创建 summary.md
spec/03-功能实现/20260104-0900-专业评价Agent设计/summary.md

# 归档后会移动到
spec/06-已归档/20260104-0900-专业评价Agent设计/
```

### 分类目录速查

| 目录 | 用途 |
|------|------|
| `01-项目规划` | PRD、流程设计、项目规划 |
| `02-架构设计` | 架构、数据模型、服务层 |
| `03-功能实现` | 功能、API、集成 |
| `04-问题修复` | Bug修复、重构 |
| `05-测试文档` | 测试计划、测试报告 |
| `06-已归档` | 已完成的 Spec（自动移动） |

## 高级功能

**详细模板**：参见 [TEMPLATES.md](TEMPLATES.md)
**示例文档**：参见 [EXAMPLES.md](EXAMPLES.md)
**最佳实践**：参见 [BEST-PRACTICES.md](BEST-PRACTICES.md)

## 检查清单

在提交 Spec 前，确认：

- [ ] 已选择正确的分类目录（01-05）
- [ ] 文件夹已创建在 `spec/分类目录/` 下
- [ ] 文件夹名格式：`YYYYMMDD-HHMM-任务描述`
- [ ] 日期和时间是当前的日期和时间
- [ ] **任务描述使用中文**
- [ ] plan.md 文件已创建
- [ ] 使用了合适的模板
- [ ] 包含所有必要的技术细节
- [ ] 设计决策有明确依据
- [ ] 提供了具体的实现步骤
- [ ] 考虑了可追溯性要求
- [ ] 考虑了并发场景
- [ ] 使用中文作为主要语言
- [ ] 已告知用户 summary.md 将在执行后创建
- [ ] 已告知用户执行完成后会归档到 `06-已归档`
- [ ] 等待用户确认后再开发

---

## 后续动作（工具记忆）

完成 Spec 文档撰写后，你应该：

### 后续流程
1. 等待用户确认 Spec
2. 用户确认后，使用 `spec-executor` 执行实现
3. 如果是功能更新，使用 `spec-updater` 执行

### 常见陷阱
- 忘记在分类目录下创建文件夹
- 任务描述使用英文而非中文
- 缺少时间部分（HHMM）
- 未等待用户确认就开始开发
